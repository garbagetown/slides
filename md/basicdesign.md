# バグが減らないのは<br/>どう考えても<br/>設計書が悪い!

2016-03-24<br/>
DTS Developer's Meetup #10

---

## 自己紹介
- 梅澤 雄一郎
- 産業公共事業本部産業事業部
  - オムニチャネル案件ビッグデータ担当
  - ITA-s
- 業務外
  - Play Framework ドキュメント翻訳 (協力者募集中!)
  - WEB+DB PRESS vol.71 寄稿
  - Developer's Summit 2014 登壇

---

## 今回のスコープ

### バグが減らないのは<br/>どう考えても<br/>"基本" 設計書が悪い!

---

## 基本設計書とは
- 個人的な観測範囲内ではこういうのが多い
  - 日本語 if-else
  - 日本語論理和/積
  - 日本語 SQL
  - フラグ、区分、コード
  - 正常系のみ記述

---

## こういう感じ
商品売価取得処理
- 処理 1.2-3 で取得した商品の販促フラグが '1' の場合  
  売価マスタ.適用期間開始日 >= 現在日時かつ  
  売価マスタ.適用期間終了日 < 現在日時のうち  
  売価区分が '02' かつ  
  ステータスコードが '99' ではないデータを取得する

---

## なにか問題でも？
- なんだかちゃんとしてるっぽい
  - 実際のところ読みづらくてよく分からない
- "何をする" は書いてあるけど "何故そうする" は  
  書いていない
  - 内容が正しいのかどうかよく分からない

---

## 基本設計書って<br/>本当にこれでいいの？

---

## V 字開発モデル

![](img/basicdesign_001.png)

<small>[Vモデル - Wikipedia](https://ja.wikipedia.org/wiki/V%E3%83%A2%E3%83%87%E3%83%AB) より</small>

---

## 関連する工程と担当
- 入力
  - 要件定義 (顧客)
- 出力
  - 詳細設計 (オフショア開発者)
  - システムテスト (テスト担当者)

(※一般的な多重請負開発の場合)

---

## 担当と責務と制限
- 顧客
  - 要件が実現されていることを検証する
  - 専門的な記述は理解できない
- オフショア開発者
  - 基本設計をもとに詳細設計書を作成する
  - 難解な日本語は理解できない
- テスト担当者
  - 試験項目書を作成し、不具合を検出する
  - 別チームや若手メンバが担当することもある

---

## みんなの気持ちで見てみよう
商品売価取得処理
- 処理 1.2-3 で取得した商品の販促フラグが '1' の場合  
  売価マスタ.適用期間開始日 >= 現在日時かつ  
  売価マスタ.適用期間終了日 < 現在日時のうち  
  売価区分が '02' かつ  
  ステータスコードが '99' ではないデータを取得する

---

## みんなの気持ち
- 顧客
  - (なにが書いてあるのか分からない...)
- オフショア開発者
  - (日本語読むのつらいアル...)
  - (準正常/異常系の場合はどうすれば？)
- テスト担当者
  - (あり得る条件の組み合わせは何通り？)

---

## 結果、こうなる
- 顧客
  - (とりあえず誤字を指摘しよう...)
- オフショア開発者
  - (正常系だけ設計するアル...)
  - (詳細設計はコピペするアル...)
- テスト担当者
  - (正常系と異常系だけ試験するか...)

---

## バグが減らないのは<br/>どう考えても<br/>基本設計書が悪い!
  
---

## 基本設計書って<br/>本当にこれでいいの？

---

## 原点回帰

![](img/basicdesign_002.png)

<small>[V-Model (software development) - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/V-Model_(software_development)) より</small>

---

## 要求とアーキテクチャ
- Requirements and Architecture
  - 基本設計 (BD: BasicDesign) とは呼ばない
- Requirements
  - 要求
  - 顧客のシステムに対する要求
- Architecture
  - アーキテクチャ
  - システムを実現する構成

---

## 考察
- "基本設計書" という名前が良くないのでは
  - ふわっとしていて記述範囲が不明瞭
  - "外部システム仕様書" などが適切
- 顧客のシステムに対する要求を記述すべき
- 顧客が求めるシステムを実現する構成を  
  記述すべき

---

## 結論
- "基本設計書" には、以下の内容を記述する。
  - システムを外部から見た振る舞い
    - 正常/準正常/異常系の入力に対する出力
  - システムを構成する要素とインタフェース
    - 要素内の実装は詳細設計工程で記述
- 読み手の責務、能力を考慮して記述する。
  - 平易、簡潔、網羅的
  - 適宜、図表を活用する

---

## 実践
商品売価取得処理
- 注文単価には、商材区分に応じた売価を設定する。  
  売価は期間によって変動する。  
  商材区分に応じた売価が複数存在する場合は、  
  エラー画面を表示する。  
  商材区分、売価の組み合わせは下図の通り。

|区分|種別|売価|
|----|----|----|
|01|通常商材|販売価格|
|02|販促商材|キャンペーン価格|
|03|予約商材|販売予定価格|

---

## まとめ
- "基本設計書" という呼び方をやめよう
- 担当工程の目的と範囲を明確にしよう
- 担当工程の作業に全力を尽くそう
- 利用者の責務、能力を考慮して、  
  最大限に有効な成果物を作ろう

---

## おまけ

![](img/basicdesign_003.jpg)

---

# 次回予告

## 詳細設計書不要論

## 論理削除フラグ (笑)

## さらば Excel 方眼紙

---

# おわり
