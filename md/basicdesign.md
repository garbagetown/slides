# バグが減らないのは<br/>どう考えても<br/>設計書が悪い!

2016-03-24<br/>
DTS Developer's Meetup #10

---

## 自己紹介
- 梅澤 雄一郎
- 産業公共事業本部産業事業部
  - オムニチャネル案件ビッグデータ担当
  - ITA-s
- 業務外
  - Play Framework ドキュメント翻訳 (協力者募集中!)
  - WEB+DB PRESS vol.71 寄稿
  - Developer's Summit 2014 登壇

---

  ## バグが減らないのは<br/>どう考えても<br/><font color="red">基本</font>設計書が悪い!

---

## 基本設計書とは
- 個人的な観測範囲内ではこういうのが多い
  - 日本語 if-else
  - 日本語論理和/積
  - 日本語 SQL
  - フラグ、区分、コード
  - 正常系のみ

---

## こういう感じ
- 処理 1.2-3 で取得した商品の販促フラグが '1' の場合  
  売価マスタ.適用期間開始日 >= 現在日時かつ  
  売価マスタ.適用期間終了日 < 現在日時のうち  
  売価区分が '02' かつ  
  ステータスコードが '99' ではないデータを取得する

---

## なにが問題？
- なんだかちゃんとしてるっぽい
  - 実際のところ読みづらくてよく分からない
  - 分かったつもりになる
- "何をする" は書いてあるけど<br/>"何故そうする" は書いていない
  - 内容が正しいのかどうかよく分からない
  - レビューが指摘し易い誤字や様式違反に終始する

---

## 基本設計書って<br/>本当にこれでいいの？

---

## V 字開発モデル

![](img/basicdesign_001.png)

<small>[Vモデル - Wikipedia](https://ja.wikipedia.org/wiki/V%E3%83%A2%E3%83%87%E3%83%AB) より</small>

---

## 前後工程と担当
(※一般的な多重請負開発の場合)
- 入力
  - 要求分析 (顧客)
- 出力
  - 詳細設計 (オフショア開発者)
  - システムテスト (テスト担当者)


---

## 担当と責務と制限
- 顧客
  - 要求分析と齟齬がないことを検証する
  - 専門的な記述は理解できない
- オフショア開発者
  - 基本設計をもとに詳細設計書を作成する
  - 難解な日本語は理解できない
- テスト担当者
  - 試験項目書を作成し、不具合を検出する
  - 別チームや若手メンバが担当することもある

---

## みんなの気持ちで見てみよう
- 処理 1.2-3 で取得した商品の販促フラグが '1' の場合  
  売価マスタ.適用期間開始日 >= 現在日時かつ  
  売価マスタ.適用期間終了日 < 現在日時のうち  
  売価区分が '02' かつ  
  ステータスコードが '99' ではないデータを取得する

---

## みんなの気持ち
- 顧客
  - (なにが書いてあるのか分からん...)
- オフショア開発者
  - (日本語読むのつらいアル...)
  - (準正常/異常系の場合はどうすれば？)
- テスト担当者
  - (あり得る条件の組み合わせは何通り？)

---

## 基本設計書って<br/>本当にこれでいいの？

---

## どうしてこうなった

---

## 世界に目を向ける

![](img/basicdesign_002.png)

<small>[V-Model (software development) - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/V-Model_(software_development)) より</small>

---

## 要求とアーキテクチャ
基本設計 (BD: BasicDesign) とは呼んでいない
- 要求
  - 顧客が望むシステムの振る舞い
- アーキテクチャ
  - システムの論理的な構造、設計思想

---

## 結論
- "基本設計書" という曖昧な名前が良くない
  - 記述すべき範囲が不明瞭
  - "外部システム仕様書" などが適切
- システムを外部から見た振る舞いを定義する
  - 正常/準正常/異常系の入力に対する出力
- システムを構成する要素とインタフェースを定義する
  - 要素内の実装詳細はダメ。ゼッタイ。
- 読み手の責務、能力を考慮して記述する
  - 平易、簡潔、網羅的

---

## 実践
- 注文単価には、商材区分に応じた売価を設定する。  
  商材区分に応じた売価が複数存在する場合は、  
  エラー画面を表示する。  
  商材区分、売価の組み合わせは下図の通り。

|区分|売価|
|----|----|
|通常商材|販売価格|
|販促商材|キャンペーン価格|
|予約商材|販売予定価格|

---

## まとめ
- "基本設計書" という名前をやめよう
- 工程範囲内の作業にまず全力を尽くそう
- 利用者の責務、能力を考慮して、最大限に  
  有効な成果物を作ろう

---

## おまけ

![](img/basicdesign_003.jpg)

---

# 次回予告

## 詳細設計書不要説

## 消えろ！論理削除フラグ

## さらば Excel 方眼紙

---

# おわり
